{% extends "base.html" %}

{% block title %}My Profile - PMS Portal{% endblock %}

{% block content %}
<div class="tab-container">
    <!-- Header -->
    <div class="tab-header">
        <h1>My Profile</h1>
        <div class="tab-actions">
            <a href="/profile/change-password" class="btn btn-secondary btn-sm">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                    <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                </svg>
                Change Password
            </a>
        </div>
    </div>

    <!-- Messages -->
    {% if message %}
    <div style="padding: 12px 20px; background: #dcfce7; color: #166534; border-radius: 8px; margin: 16px 20px 0; font-size: 0.875rem;">
        {{ message }}
    </div>
    {% endif %}
    {% if error %}
    <div style="padding: 12px 20px; background: #fee2e2; color: #991b1b; border-radius: 8px; margin: 16px 20px 0; font-size: 0.875rem;">
        {{ error }}
    </div>
    {% endif %}

    <!-- Profile Content -->
    <div style="padding: 20px;">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
            <!-- Personal Information Card -->
            <div class="card">
                <div class="card-header">
                    <h3 style="display: flex; align-items: center; gap: 8px;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#3b82f6" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                        Personal Information
                    </h3>
                </div>
                <div style="display: flex; flex-direction: column; gap: 16px;">
                    <div class="detail-row">
                        <span class="detail-label">Officer ID</span>
                        <span class="detail-value" style="font-family: monospace;">{{ officer.officer_id }}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Name</span>
                        <span class="detail-value"><strong>{{ officer.name }}</strong></span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Email</span>
                        <span class="detail-value">{{ officer.email }}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Designation</span>
                        <span class="detail-value">{{ officer.designation or '-' }}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Discipline</span>
                        <span class="detail-value">{{ officer.discipline or '-' }}</span>
                    </div>
                </div>
            </div>

            <!-- Office & Role Card -->
            <div class="card">
                <div class="card-header">
                    <h3 style="display: flex; align-items: center; gap: 8px;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2">
                            <rect x="3" y="3" width="7" height="7"></rect>
                            <rect x="14" y="3" width="7" height="7"></rect>
                            <rect x="14" y="14" width="7" height="7"></rect>
                            <rect x="3" y="14" width="7" height="7"></rect>
                        </svg>
                        Office & Role
                    </h3>
                </div>
                <div style="display: flex; flex-direction: column; gap: 16px;">
                    <div class="detail-row">
                        <span class="detail-label">Office</span>
                        <span class="detail-value"><strong>{{ officer.office_id }}</strong></span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Office Name</span>
                        <span class="detail-value">{{ officer.office_name or '-' }}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Admin Role</span>
                        <span class="detail-value">
                            {% if officer.admin_role_id %}
                            <span class="badge badge-primary">{{ officer.admin_role_id }}</span>
                            {% else %}
                            <span class="badge badge-secondary">Officer</span>
                            {% endif %}
                        </span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Annual Target</span>
                        <span class="detail-value"><strong>{{ "%.1f"|format(officer.annual_target or 60) }} L</strong></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Roles Section -->
        {% if roles %}
        <div class="card" style="margin-top: 24px;">
            <div class="card-header">
                <h3 style="display: flex; align-items: center; gap: 8px;">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#8b5cf6" stroke-width="2">
                        <path d="M12 2l3 7h7l-5.5 4.5 2 7L12 16l-6.5 4.5 2-7L2 9h7l3-7z"></path>
                    </svg>
                    Assigned Roles
                </h3>
            </div>
            <table class="compact-table">
                <thead>
                    <tr>
                        <th>Role</th>
                        <th>Scope</th>
                        <th>Effective From</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for role in roles %}
                    <tr>
                        <td>
                            <strong>{{ role.role_type }}</strong>
                            {% if role.is_primary %}
                            <span class="badge badge-success" style="font-size: 0.625rem; margin-left: 4px;">Primary</span>
                            {% endif %}
                        </td>
                        <td>
                            {{ role.scope_type or '-' }}
                            {% if role.scope_value %}
                            <span style="color: #64748b;">- {{ role.scope_value }}</span>
                            {% endif %}
                        </td>
                        <td>{{ role.effective_from }}</td>
                        <td><span class="badge badge-success">Active</span></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}

        <!-- Performance Summary -->
        <div class="card" style="margin-top: 24px;">
            <div class="card-header">
                <h3 style="display: flex; align-items: center; gap: 8px;">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#f59e0b" stroke-width="2">
                        <line x1="18" y1="20" x2="18" y2="10"></line>
                        <line x1="12" y1="20" x2="12" y2="4"></line>
                        <line x1="6" y1="20" x2="6" y2="14"></line>
                    </svg>
                    Performance Summary
                </h3>
            </div>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;">
                <div style="padding: 20px; background: linear-gradient(135deg, #dbeafe, #bfdbfe); border-radius: 12px; text-align: center;">
                    <div style="font-size: 2rem; font-weight: 700; color: #1d4ed8;">{{ stats.assignment_count or 0 }}</div>
                    <div style="font-size: 0.875rem; color: #3b82f6;">Assignments</div>
                </div>
                <div style="padding: 20px; background: linear-gradient(135deg, #dcfce7, #bbf7d0); border-radius: 12px; text-align: center;">
                    <div style="font-size: 2rem; font-weight: 700; color: #166534;">{{ "%.1f"|format(stats.total_revenue or 0) }}L</div>
                    <div style="font-size: 0.875rem; color: #16a34a;">Total Revenue Share</div>
                </div>
                <div style="padding: 20px; background: linear-gradient(135deg, #fef3c7, #fde68a); border-radius: 12px; text-align: center;">
                    {% set achievement = ((stats.total_revenue or 0) / (officer.annual_target or 60) * 100)|round|int %}
                    <div style="font-size: 2rem; font-weight: 700; color: #92400e;">{{ achievement }}%</div>
                    <div style="font-size: 0.875rem; color: #b45309;">Achievement</div>
                </div>
            </div>
        </div>

        <!-- Quick Links -->
        <div style="margin-top: 24px; display: flex; gap: 12px; flex-wrap: wrap;">
            <a href="/mis/officer/{{ officer.officer_id }}" class="btn btn-primary">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="20" x2="18" y2="10"></line>
                    <line x1="12" y1="20" x2="12" y2="4"></line>
                    <line x1="6" y1="20" x2="6" y2="14"></line>
                </svg>
                View My MIS
            </a>
            <a href="/dashboard" class="btn btn-secondary">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="7" height="7"></rect>
                    <rect x="14" y="3" width="7" height="7"></rect>
                    <rect x="14" y="14" width="7" height="7"></rect>
                    <rect x="3" y="14" width="7" height="7"></rect>
                </svg>
                Dashboard
            </a>
        </div>
    </div>
</div>

<style>
.detail-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 0;
    border-bottom: 1px solid #f1f5f9;
}
.detail-row:last-child {
    border-bottom: none;
}
.detail-label {
    font-size: 0.875rem;
    color: #64748b;
}
.detail-value {
    font-size: 0.875rem;
    color: #1e293b;
    text-align: right;
}
@media (max-width: 768px) {
    div[style*="grid-template-columns: 1fr 1fr"] {
        grid-template-columns: 1fr !important;
    }
    div[style*="grid-template-columns: repeat(3, 1fr)"] {
        grid-template-columns: 1fr !important;
    }
}
</style>
{% endblock %}
