{% extends "base.html" %}

{% block title %}Training Programmes - PMS Portal{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Training Programmes</h1>
    <div>
        <a href="/training/create" class="btn btn-primary">+ New Programme</a>
        <a href="/dashboard" class="btn btn-secondary">Dashboard</a>
    </div>
</div>

<!-- Summary Cards -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 30px;">
    <div class="card" style="text-align: center; padding: 15px;">
        <h3 style="color: #3182ce; margin: 0;">{{ stats.total }}</h3>
        <p style="margin: 5px 0 0; color: #718096; font-size: 12px;">Total Programmes</p>
    </div>
    <div class="card" style="text-align: center; padding: 15px;">
        <h3 style="color: #805ad5; margin: 0;">{{ stats.announced }}</h3>
        <p style="margin: 5px 0 0; color: #718096; font-size: 12px;">Announced</p>
    </div>
    <div class="card" style="text-align: center; padding: 15px;">
        <h3 style="color: #dd6b20; margin: 0;">{{ stats.registration_open }}</h3>
        <p style="margin: 5px 0 0; color: #718096; font-size: 12px;">Reg. Open</p>
    </div>
    <div class="card" style="text-align: center; padding: 15px;">
        <h3 style="color: #38a169; margin: 0;">{{ stats.conducted }}</h3>
        <p style="margin: 5px 0 0; color: #718096; font-size: 12px;">Conducted</p>
    </div>
    <div class="card" style="text-align: center; padding: 15px;">
        <h3 style="color: #3182ce; margin: 0;">{{ "%.2f"|format(stats.total_budgeted or 0) }}L</h3>
        <p style="margin: 5px 0 0; color: #718096; font-size: 12px;">Budgeted</p>
    </div>
    <div class="card" style="text-align: center; padding: 15px;">
        <h3 style="color: #38a169; margin: 0;">{{ "%.2f"|format(stats.total_actual or 0) }}L</h3>
        <p style="margin: 5px 0 0; color: #718096; font-size: 12px;">Actual</p>
    </div>
</div>

<!-- Training Programmes List -->
<div class="card">
    <div class="card-header">
        <h2 class="card-title">All Training Programmes</h2>
    </div>

    {% if programmes %}
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>Programme No</th>
                    <th>Title</th>
                    <th>Office</th>
                    <th>Dates</th>
                    <th>Coordinator</th>
                    <th>Stage</th>
                    <th>Budgeted</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for p in programmes %}
                <tr>
                    <td><a href="/training/view/{{ p.id }}">{{ p.programme_number }}</a></td>
                    <td>{{ p.title[:35] }}{% if p.title|length > 35 %}...{% endif %}</td>
                    <td>{{ p.office_id }}</td>
                    <td>
                        {% if p.training_start_date %}
                        {{ p.training_start_date }} - {{ p.training_end_date or '?' }}
                        {% else %}
                        -
                        {% endif %}
                    </td>
                    <td>{{ p.coordinator_name or '-' }}</td>
                    <td>
                        <span class="badge
                            {% if p.stage == 'ANNOUNCED' %}badge-info
                            {% elif p.stage == 'REGISTRATION_OPEN' %}badge-warning
                            {% elif p.stage == 'CONDUCTED' %}badge-success
                            {% elif p.stage == 'CLOSED' %}badge-secondary
                            {% else %}badge-primary{% endif %}">
                            {{ p.stage|replace('_', ' ') }}
                        </span>
                    </td>
                    <td>{{ "%.2f"|format(p.budgeted_revenue or 0) }}L</td>
                    <td>
                        <a href="/training/view/{{ p.id }}" class="btn btn-sm btn-primary">View</a>
                        <a href="/training/edit/{{ p.id }}" class="btn btn-sm btn-secondary">Edit</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <p class="text-muted text-center" style="padding: 50px;">
        No training programmes found. <a href="/training/create">Create your first programme</a>
    </p>
    {% endif %}
</div>
{% endblock %}
