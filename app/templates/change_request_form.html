{% extends "base.html" %}

{% block title %}Request Change - {{ assignment.assignment_no }} - PMS Portal{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Request Change</h1>
    <div>
        <a href="/assignment/view/{{ assignment.id }}" class="btn btn-secondary">Back to Assignment</a>
    </div>
</div>

<div style="margin-bottom: 20px;">
    <h3 style="margin: 0; color: #2d3748;">{{ assignment.assignment_no }} - {{ assignment.title }}</h3>
    <p class="text-muted" style="margin-top: 4px;">Office: {{ assignment.office_id }} | Type: {{ assignment.type }}</p>
</div>

{% if error %}
<div class="alert alert-danger" style="margin-bottom: 20px; padding: 15px; background: #fff5f5; border: 1px solid #fc8181; border-radius: 8px;">
    {{ error }}
</div>
{% endif %}

<div class="card">
    <form method="POST" action="/change-request/new/{{ assignment.id }}">
        <h3 style="margin-bottom: 20px; color: #2d3748; border-bottom: 1px solid #e2e8f0; padding-bottom: 10px;">
            Change Request Details
        </h3>

        <div class="form-group">
            <label for="change_type">Change Type *</label>
            <select id="change_type" name="change_type" class="form-control" required>
                <option value="">Select type of change</option>
                <option value="MILESTONE_CHANGE">Milestone Change</option>
                <option value="COST_CHANGE">Cost Estimation Change</option>
                <option value="TEAM_CHANGE">Team Constitution Change</option>
                <option value="REVENUE_CHANGE">Revenue Sharing Change</option>
            </select>
        </div>

        <div class="form-group">
            <label for="details">What changes are needed?</label>
            <textarea id="details" name="details" class="form-control" rows="4"
                      placeholder="Describe the specific changes you want to make (e.g., extend milestone 3 deadline by 2 weeks, add a new team member, revise cost estimate for travel)"></textarea>
        </div>

        <div class="form-group">
            <label for="justification">Justification *</label>
            <textarea id="justification" name="justification" class="form-control" rows="3" required
                      placeholder="Explain why this change is needed"></textarea>
        </div>

        <div style="margin-top: 25px; padding-top: 15px; border-top: 1px solid #e2e8f0; display: flex; gap: 12px;">
            <button type="submit" class="btn btn-primary">Submit Change Request</button>
            <a href="/assignment/view/{{ assignment.id }}" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
</div>

<!-- Flow Info -->
<div class="card" style="margin-top: 20px; background: #f7fafc;">
    <h4 style="margin-bottom: 12px; color: #4a5568;">Approval Flow</h4>
    <div style="display: flex; flex-wrap: wrap; gap: 8px; align-items: center;">
        <span class="badge" style="background: #3b82f6; color: white; padding: 6px 12px;">1. You Submit</span>
        <span style="color: #a0aec0;">&rarr;</span>
        <span class="badge" style="background: #e2e8f0; color: #718096; padding: 6px 12px;">2. TL Reviews</span>
        <span style="color: #a0aec0;">&rarr;</span>
        <span class="badge" style="background: #e2e8f0; color: #718096; padding: 6px 12px;">3. Head Approves</span>
    </div>
    <p class="text-muted" style="margin-top: 8px; font-size: 0.85rem;">
        Your change request will first be reviewed by the Team Leader, who will either forward it to the Head for approval or reject it.
    </p>
</div>
{% endblock %}
