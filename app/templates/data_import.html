{% extends "base.html" %}

{% block title %}Import Data - PMS Portal{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Import Data</h1>
    <div>
        <a href="/data/export" class="btn btn-primary">Export Data</a>
        <a href="/dashboard" class="btn btn-secondary">Back to Dashboard</a>
    </div>
</div>

{% if success_counts %}
<div class="card" style="border-left: 4px solid #48bb78; margin-bottom: 20px;">
    <div class="card-header">
        <h2 class="card-title" style="color: #276749;">Import Results</h2>
    </div>

    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
        <div style="text-align: center; padding: 15px; background: #f0fff4; border-radius: 8px;">
            <h3 style="margin: 0; color: #276749;">{{ success_counts.assignments }}</h3>
            <p style="margin: 5px 0 0; color: #48bb78;">Assignments</p>
        </div>
        <div style="text-align: center; padding: 15px; background: #f0fff4; border-radius: 8px;">
            <h3 style="margin: 0; color: #276749;">{{ success_counts.milestones }}</h3>
            <p style="margin: 5px 0 0; color: #48bb78;">Milestones</p>
        </div>
        <div style="text-align: center; padding: 15px; background: #f0fff4; border-radius: 8px;">
            <h3 style="margin: 0; color: #276749;">{{ success_counts.revenue_shares }}</h3>
            <p style="margin: 5px 0 0; color: #48bb78;">Revenue Shares</p>
        </div>
        <div style="text-align: center; padding: 15px; background: #f0fff4; border-radius: 8px;">
            <h3 style="margin: 0; color: #276749;">{{ success_counts.expenditure }}</h3>
            <p style="margin: 5px 0 0; color: #48bb78;">Expenditure Items</p>
        </div>
        <div style="text-align: center; padding: 15px; background: #f0fff4; border-radius: 8px;">
            <h3 style="margin: 0; color: #276749;">{{ success_counts.config }}</h3>
            <p style="margin: 5px 0 0; color: #48bb78;">Config Options</p>
        </div>
    </div>

    {% if errors %}
    <div style="margin-top: 20px; padding: 15px; background: #fff5f5; border-radius: 8px;">
        <h4 style="color: #c53030; margin: 0 0 10px;">Errors ({{ total_errors }} total):</h4>
        <ul style="margin: 0; color: #c53030; font-size: 0.9em;">
            {% for error in errors %}
            <li>{{ error }}</li>
            {% endfor %}
            {% if total_errors > 20 %}
            <li>... and {{ total_errors - 20 }} more errors</li>
            {% endif %}
        </ul>
    </div>
    {% endif %}
</div>
{% endif %}

<div class="card">
    <div class="card-header">
        <h2 class="card-title">Upload Excel File</h2>
    </div>

    <form method="POST" action="/data/import" enctype="multipart/form-data">
        <div class="form-group">
            <label for="file">Select Excel File (.xlsx)</label>
            <input type="file" id="file" name="file" class="form-control"
                   accept=".xlsx,.xls" required
                   style="padding: 10px; border: 2px dashed #cbd5e0; border-radius: 8px;">
        </div>

        <div class="form-group">
            <label for="import_mode">Import Mode</label>
            <select id="import_mode" name="import_mode" class="form-control">
                <option value="update">Update existing & Add new (Recommended)</option>
                <option value="add_only">Add new records only</option>
            </select>
        </div>

        <div style="margin-top: 20px;">
            <button type="submit" class="btn btn-success btn-lg">Upload & Import</button>
        </div>
    </form>
</div>

<div class="card">
    <div class="card-header">
        <h2 class="card-title">Supported Sheets</h2>
    </div>

    <table>
        <thead>
            <tr>
                <th>Sheet Name</th>
                <th>Description</th>
                <th>Key Fields</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><strong>Assignments</strong></td>
                <td>Assignment and training records</td>
                <td>ID (for updates), Assignment No, Type, Title, Office</td>
            </tr>
            <tr>
                <td><strong>Milestones</strong></td>
                <td>Milestone details per assignment</td>
                <td>Assignment ID, Milestone No</td>
            </tr>
            <tr>
                <td><strong>Revenue Shares</strong></td>
                <td>Officer revenue allocations</td>
                <td>Assignment ID, Officer ID</td>
            </tr>
            <tr>
                <td><strong>Expenditure</strong></td>
                <td>Cost estimates and actuals</td>
                <td>Assignment ID, Head Code</td>
            </tr>
            <tr>
                <td><strong>Config Options</strong></td>
                <td>Dropdown options (domains, etc.)</td>
                <td>Category, Value</td>
            </tr>
        </tbody>
    </table>

    <div style="padding: 15px; background: #ebf8ff; border-radius: 8px; margin-top: 20px;">
        <strong style="color: #2b6cb0;">Tip:</strong>
        <span style="color: #2b6cb0;">
            First export the current data to get the correct format, then modify and re-import.
        </span>
    </div>
</div>
{% endblock %}
